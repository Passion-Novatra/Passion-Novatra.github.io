---
export interface Props {
  title: string;
}
const { title } = Astro.props;
---

<!doctype html>
<html lang="zh" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>{title}</title>
    <script is:inline>
      if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
      }
    </script>
    <link rel="stylesheet" href="/_astro/about.BWwiBGH1.css" />
    <style>
      /* 左侧面板宽度 */
      .admin-sidebar { width: 240px; }
      .admin-main { margin-left: 240px; }
      @media (max-width: 768px) {
        .admin-sidebar { width: 0; transform: translateX(-100%); transition: transform 0.3s; }
        .admin-sidebar.open { transform: translateX(0); }
        .admin-main { margin-left: 0; }
      }
    </style>
  </head>
  <body class="min-h-screen bg-stone-50 dark:bg-stone-950 text-stone-900 dark:text-stone-100 antialiased">
    <!-- 顶部导航 -->
    <header class="sticky top-0 z-20 border-b border-stone-200 dark:border-stone-800 bg-white/80 dark:bg-stone-900/80 backdrop-blur-sm">
      <div class="max-w-full mx-auto px-4 py-3 flex items-center justify-between">
        <div class="flex items-center gap-3">
          <button id="menuToggle" class="md:hidden p-2 rounded-md hover:bg-stone-100 dark:hover:bg-stone-800">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
          </button>
          <img src="/logo.svg" alt="Logo" class="h-7" />
          <span class="font-bold text-lg">管理后台</span>
        </div>
        <div class="flex items-center gap-4">
          <span id="userName" class="text-sm text-stone-600 dark:text-stone-400"></span>
          <button id="logoutBtn" class="text-sm underline">退出</button>
        </div>
      </div>
    </header>

    <!-- 左侧功能面板 -->
    <aside id="sidebar" class="admin-sidebar fixed left-0 top-[53px] bottom-0 border-r border-stone-200 dark:border-stone-800 bg-white dark:bg-stone-900 overflow-y-auto">
      <nav class="p-4 space-y-2">
        <slot name="nav" />
      </nav>
    </aside>

    <!-- 右侧主功能区 -->
    <main class="admin-main pt-6 px-6 pb-12">
      <slot />
    </main>

    <script>
      // 移动端菜单开关
      const menuToggle = document.getElementById('menuToggle');
      const sidebar = document.getElementById('sidebar');
      menuToggle?.addEventListener('click', () => sidebar?.classList.toggle('open'));

      // 退出登录
      document.getElementById('logoutBtn')?.addEventListener('click', () => {
        localStorage.removeItem('github_token');
        location.href = '/admin/login';
      });

      // 显示用户名（从 token 获取）
      const token = localStorage.getItem('github_token');
      if (token) {
        fetch('https://api.github.com/user', {
          headers: { Authorization: `Bearer ${token}` }
        }).then(r => r.json()).then(user => {
          document.getElementById('userName').textContent = user.login || '';
        });
      }
    </script>
  </body>
</html>
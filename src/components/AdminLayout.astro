---
import Layout from './Layout.astro';
export interface Props {
  title: string;
}
const { title } = Astro.props;
---

<Layout title={title}>
  <!-- 顶部导航栏 -->
  <header class="sticky top-0 z-20 border-b border-stone-200 dark:border-stone-800 bg-white/80 dark:bg-stone-900/80 backdrop-blur-sm">
    <div class="max-w-full mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <!-- 移动端菜单按钮 -->
        <button id="menuToggle" class="md:hidden p-2 rounded-md hover:bg-stone-100 dark:hover:bg-stone-800">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
        </button>
        <!-- LOGO -->
        <img src="/logo.svg" alt="Logo" class="h-8 w-8 object-contain" />
        <span class="font-bold text-lg">管理后台</span>
      </div>

      <div class="flex items-center gap-4">
        <!-- 用户名 -->
        <span id="userName" class="text-sm text-stone-600 dark:text-stone-400"></span>
        <!-- 退出 -->
        <button id="logoutBtn" class="text-sm underline">退出</button>
        <!-- 返回博客首页 -->
        <a href="/" class="text-sm text-stone-500 dark:text-stone-400 hover:underline">返回博客</a>
      </div>
    </div>
  </header>

  <!-- 左侧菜单 -->
  <div class="flex">
    <aside id="sidebar" class="w-64 md:w-56 border-r border-stone-200 dark:border-stone-800 bg-white dark:bg-stone-900 p-4 space-y-2">
      <slot name="nav" />
    </aside>

    <!-- 右侧主内容 -->
    <main class="flex-1 p-6">
      <slot />
    </main>
  </div>

  <script>
    // 移动端菜单开关
    const menuToggle = document.getElementById('menuToggle');
    const sidebar = document.getElementById('sidebar');
    menuToggle?.addEventListener('click', () => sidebar?.classList.toggle('hidden'));

    // 退出登录
    document.getElementById('logoutBtn')?.addEventListener('click', () => {
      localStorage.removeItem('_n_a_i_');
      location.href = '/admin/login';
    });

    // 显示用户名
    const raw = localStorage.getItem('_n_a_i_');
    if (raw) {
      try {
        const { t } = JSON.parse(atob(raw));
        fetch('https://api.github.com/user', {
          headers: { Authorization: `Bearer ${t}` }
        }).then(r => r.json()).then(user => {
          document.getElementById('userName').textContent = user.login || '';
        });
      } catch {}
    }
  </script>
</Layout>